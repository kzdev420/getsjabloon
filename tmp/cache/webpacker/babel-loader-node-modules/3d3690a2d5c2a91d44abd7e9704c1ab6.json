{"ast":null,"code":"function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (typeof call === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nimport { Controller } from \"stimulus\";\n\nvar _default = /*#__PURE__*/function (_Controller) {\n  _inherits(_default, _Controller);\n\n  var _super = _createSuper(_default);\n\n  function _default() {\n    _classCallCheck(this, _default);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(_default, [{\n    key: \"connect\",\n    value: function connect() {\n      this.timeout = null;\n      this.duration = this.data.get(\"duration\") || 600;\n      this.intlFormat = this.data.get(\"intlFormat\") || \"en-US\";\n      this.validColor = this.data.get(\"validColor\") || \"bg-green-500\";\n      this.inValidColor = this.data.get(\"inValidColor\") || \"bg-red-500\";\n      this.isCouponApplied = false;\n      this.clearDiscount();\n    }\n  }, {\n    key: \"checkValidity\",\n    value: function checkValidity() {\n      var _this = this;\n\n      clearTimeout(this.timeout);\n      this.setStatus(\"Checking…\");\n      this.timeout = setTimeout(function () {\n        fetch(\"\".concat(_this.data.get(\"url\"), \"?code=\").concat(_this.inputTarget.value)).then(function (response) {\n          return response.json();\n        }).then(function (response) {\n          _this.showResponse(response);\n        });\n      }, this.duration);\n    }\n  }, {\n    key: \"showResponse\",\n    value: function showResponse(response) {\n      var status = response.status;\n\n      if (status == \"valid\") {\n        this.calculateNewAmount(response);\n        this.showStatusMessage(response);\n      } else if (status == \"not valid\") {\n        this.setStatus(\"Coupon not valid or expired\");\n        this.indicatorTarget.classList.remove(this.validColor);\n        this.indicatorTarget.classList.add(this.inValidColor);\n        this.clearDiscount();\n      }\n    }\n  }, {\n    key: \"error\",\n    value: function error() {\n      this.setStatus(\"Sorry. Something went wrong.\");\n    }\n  }, {\n    key: \"setStatus\",\n    value: function setStatus(message) {\n      this.statusTarget.textContent = message;\n    }\n  }, {\n    key: \"calculateNewAmount\",\n    value: function calculateNewAmount(response) {\n      if (this.isCouponApplied) return;\n      var amount = parseInt(this.amountTarget.textContent);\n      var new_amount = null;\n\n      if (response.percent_off) {\n        var percent = parseInt(response.percent_off);\n        var discount = amount / 100 * percent;\n        new_amount = amount - discount;\n      } else {\n        var amount_off = parseInt(response.amount_off) / 100;\n        new_amount = amount - amount_off;\n      }\n\n      this.showNewAmount(new_amount, response.currency);\n    }\n  }, {\n    key: \"showStatusMessage\",\n    value: function showStatusMessage(response) {\n      var message = null;\n\n      if (!!response.percent_off) {\n        message = \"\".concat(response.percent_off, \"% off \").concat(this.time_period(response.duration, response.duration_in_months));\n      } else {\n        message = \"\".concat((parseInt(response.amount_off) / 100).toLocaleString(this.intlFormat, {\n          style: \"currency\",\n          currency: response.currency || \"usd\"\n        }), \" off \").concat(this.time_period(response.duration, response.duration_in_months));\n      }\n\n      this.setStatus(message);\n    }\n  }, {\n    key: \"time_period\",\n    value: function time_period(duration, duration_in_months) {\n      var time_period = null;\n\n      if (!!duration_in_months) {\n        time_period = \" for \".concat(duration_in_months, \" month\").concat(duration_in_months === 1 ? \"\" : \"s\");\n      } else {\n        time_period = duration;\n      }\n\n      return time_period;\n    }\n  }, {\n    key: \"clearDiscount\",\n    value: function clearDiscount() {\n      this.amountTarget.classList.remove(\"line-through\");\n      this.discounted_amountTarget.textContent = \"\";\n      this.isCouponApplied = false;\n    }\n  }, {\n    key: \"showNewAmount\",\n    value: function showNewAmount(new_amount, currency) {\n      this.discounted_amountTarget.textContent = new_amount.toLocaleString(this.intlFormat);\n      this.amountTarget.classList.add(\"line-through\");\n      this.indicatorTarget.classList.add(this.validColor);\n      this.isCouponApplied = true;\n    }\n  }]);\n\n  return _default;\n}(Controller);\n\n_default.targets = [\"input\", \"amount\", \"discounted_amount\", \"status\", \"indicator\"];\nexport { _default as default };","map":{"version":3,"sources":["/home/good-dev/Documents/Work/heytasker4/frontend/controllers/sjabloon/coupon_controller.js"],"names":["Controller","timeout","duration","data","get","intlFormat","validColor","inValidColor","isCouponApplied","clearDiscount","clearTimeout","setStatus","setTimeout","fetch","inputTarget","value","then","response","json","showResponse","status","calculateNewAmount","showStatusMessage","indicatorTarget","classList","remove","add","message","statusTarget","textContent","amount","parseInt","amountTarget","new_amount","percent_off","percent","discount","amount_off","showNewAmount","currency","time_period","duration_in_months","toLocaleString","style","discounted_amountTarget","targets"],"mappings":"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","sourcesContent":["import { Controller } from \"stimulus\"\n\nexport default class extends Controller {\n  static targets = [ \"input\", \"amount\", \"discounted_amount\", \"status\", \"indicator\" ]\n\n  connect() {\n    this.timeout         = null\n    this.duration        = this.data.get(\"duration\")     || 600\n    this.intlFormat      = this.data.get(\"intlFormat\")   || \"en-US\"\n    this.validColor      = this.data.get(\"validColor\")   || \"bg-green-500\"\n    this.inValidColor    = this.data.get(\"inValidColor\") || \"bg-red-500\"\n    this.isCouponApplied = false\n    this.clearDiscount()\n  }\n\n  checkValidity() {\n    clearTimeout(this.timeout)\n\n    this.setStatus(\"Checking…\")\n    this.timeout = setTimeout(() => {\n      fetch(`${this.data.get(\"url\")}?code=${this.inputTarget.value}`)\n      .then(response => response.json())\n      .then(response => {\n        this.showResponse(response)\n      })\n    }, this.duration)\n  }\n\n  showResponse(response) {\n    const status = response.status\n\n    if (status == \"valid\") {\n      this.calculateNewAmount(response)\n      this.showStatusMessage(response)\n    }\n    else if(status == \"not valid\") {\n      this.setStatus(\"Coupon not valid or expired\")\n      this.indicatorTarget.classList.remove(this.validColor)\n      this.indicatorTarget.classList.add(this.inValidColor)\n      this.clearDiscount()\n    }\n  }\n\n  error() {\n    this.setStatus(\"Sorry. Something went wrong.\")\n  }\n\n  setStatus(message) {\n    this.statusTarget.textContent = message\n  }\n\n  calculateNewAmount(response) {\n    if (this.isCouponApplied) return\n\n    var amount     = parseInt(this.amountTarget.textContent)\n    var new_amount = null\n\n    if (response.percent_off) {\n      var percent  = parseInt(response.percent_off)\n      var discount = (amount / 100) * percent\n      new_amount   = amount - discount\n    } else {\n      var amount_off = parseInt(response.amount_off) / 100\n      new_amount     = amount - amount_off\n    }\n\n    this.showNewAmount(new_amount, response.currency)\n  }\n\n  showStatusMessage(response) {\n    var message = null\n\n    if (!!response.percent_off) {\n      message = `${response.percent_off}% off ${this.time_period(response.duration, response.duration_in_months)}`\n    } else {\n      message = `${(parseInt(response.amount_off) / 100).toLocaleString(this.intlFormat, { style: \"currency\", currency: (response.currency || \"usd\") })} off ${this.time_period(response.duration, response.duration_in_months)}`\n    }\n\n    this.setStatus(message)\n  }\n\n  time_period(duration, duration_in_months) {\n    var time_period = null\n\n    if (!!duration_in_months) {\n      time_period = ` for ${duration_in_months} month${(duration_in_months === 1) ? \"\" : \"s\"}`\n    } else {\n      time_period = duration\n    }\n\n    return time_period\n  }\n\n  clearDiscount() {\n    this.amountTarget.classList.remove(\"line-through\")\n    this.discounted_amountTarget.textContent = \"\"\n    this.isCouponApplied = false\n  }\n\n  showNewAmount(new_amount, currency) {\n    this.discounted_amountTarget.textContent = (new_amount).toLocaleString(this.intlFormat)\n    this.amountTarget.classList.add(\"line-through\")\n    this.indicatorTarget.classList.add(this.validColor)\n    this.isCouponApplied = true\n  }\n}\n\n"]},"metadata":{},"sourceType":"module"}